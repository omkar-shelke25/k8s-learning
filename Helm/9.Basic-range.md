
Helm Templating: Mastering range Loops
This guide provides a comprehensive overview of using the range action in Helm templates to iterate over lists and generate dynamic Kubernetes manifest blocks.
1. The range Action: Purpose and Syntax
The primary function of the range action is to iterate over a collection, such as a list (slice) or a dictionary (map), defined in your values.yaml file. This allows you to generate repetitive blocks of YAML, making your templates more dynamic and maintainable.
Basic Syntax:
{{- range .Values.yourListName }}
  # Code to be executed for each item
{{- end }}

2. Example Scenario: Listing Regions in a ConfigMap
Our goal is to create a single ConfigMap that dynamically populates its data section by looping through a list of regions.
ğŸ“‚ values.yaml
Here, we define a simple list of strings under the key regions.
regions:
  - "us-east-1"
  - "us-west-1"
  - "eu-central-1"

ğŸ¯ Desired Output (ConfigMap)
We want Helm to render the following Kubernetes ConfigMap, with each region from the list correctly formatted.
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-regioninfo
data:
  regions: |
    - "us-east-1"
    - "us-west-1"
    - "eu-central-1"

3. Step-by-Step Template Implementation
To achieve the desired output, we create a configmap.yaml template using the range loop.
ğŸ› ï¸ templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-regioninfo
data:
  regions: |
  {{- range .Values.regions }}
    - {{ . | quote }}
  {{- end }}

4. Deep Dive into the Components
ğŸ§  Core Concepts Explained:
 * {{- range .Values.regions }}: This line initiates the loop.
   * range: The keyword that starts the iteration.
   * .Values.regions: The path to the list in our values.yaml.
   * {{- ... }}: The curly braces with a hyphen (-) are used for whitespace control. The hyphen trims any whitespace immediately before the tag, which cleans up the final rendered YAML.
 * The Dot (.) Scope: The meaning of the dot (.) changes inside a range block.
   * Outside the loop: . represents the root scope, giving you access to all top-level objects like .Values, .Release, .Chart, etc.
   * Inside the loop: . is redefined to be the current item in the iteration.
     * 1st Iteration: . is "us-east-1"
     * 2nd Iteration: . is "us-west-1"
     * And so on...
 * {{ . | quote }}: This line processes the current item.
   * .: The current item (e.g., "us-east-1").
   * |: The pipe character sends the value on its left to the function on its right.
   * quote: A built-in Helm function that wraps the input string in double quotes, ensuring it's treated as a valid YAML string.
 * {{- end }}: This tag closes the loop block. The hyphen (-) here would trim whitespace after the block.
ğŸ§­ Scope Diagram (Text View)
Root Scope `.`
â”œâ”€â”€ .Values
â”‚   â””â”€â”€ regions = [ "us-east-1", "us-west-1", "eu-central-1" ]
â”œâ”€â”€ .Release
â”‚   â””â”€â”€ Name = release-name
â””â”€â”€ ... (other root objects)

â†“ Inside `range .Values.regions`
  Iteration 1 â†’ . = "us-east-1"
  Iteration 2 â†’ . = "us-west-1"
  Iteration 3 â†’ . = "eu-central-1"

5. Advanced Usage: range with Index
For situations where you need the position (index) of the item in the list, you can declare variables right in the range statement.
Syntax:
{{- range $index, $value := .Values.yourListName }}
  # Your logic here
{{- end }}

Example:
# values.yaml
regions:
  - "us-east-1"
  - "us-west-1"

# template file
data:
  indexed_regions: |
  {{- range $index, $region := .Values.regions }}
    Region {{ $index }}: {{ $region | quote }}
  {{- end }}

Rendered Output:
data:
  indexed_regions: |
    Region 0: "us-east-1"
    Region 1: "us-west-1"

6. Summary and Best Practices
âœ… Summary Table
| Concept | Explanation |
|---|---|
| range | The action to iterate over lists (slices) and dictionaries (maps). |
| . (inside range) | Represents the current item being processed in the loop. |
| quote | A crucial function that wraps a string in "" for safe YAML output. |
| $ | A variable representing the root scope. Use $.Release.Name to access root objects from within a loop. |
| - in {{- | A whitespace control character that trims whitespace to the left of the tag. |
ğŸ›¡ï¸ Best Practices
 * Always quote Strings: When rendering string values into YAML data, always pipe them through the quote function to prevent YAML injection or parsing errors.
 * Use Block Scalars (|): For multi-line string data generated by a loop, use the literal block scalar (|) to preserve newlines and improve readability.
 * Mind the Scope: Remember that . changes inside a loop. To access the root context (e.g., .Release or .Values), use the dollar sign prefix: $.Release.Name.
 * Leverage Variables: For complex loops, assign the index and value to named variables (e.g., $index, $region) for better clarity.
 
